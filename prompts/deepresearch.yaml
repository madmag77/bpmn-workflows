analyse_user_query: |
  You are a helpful research assistant. Analyse the following user query: "{query}".
  Determine whether additional clarification is needed.
  Provide an improved version of the query that would work well for searching the web.
  If clarification is required, suggest concise questions for the user.
  Respond in JSON with two keys:
    extended_query: revised query text
    questions: list of questions, leave empty if none are needed

query_extender: |
  You are extending a search query for iterative research.
  Original query: "{query}"
  User clarifications: "{clarifications}"
  Current research focus: "{next_query}"
  Craft a single concise search query for the next iteration.
  Prioritize the current focus and incorporate clarifications and the original query when helpful.
  Respond in JSON with one key:
    extended_query: the rewritten query

process_info: |
  You are compiling research information to answer a user question.
  Original query: "{query}"
  Extended query used for retrieval: "{extended_query}"
  Current draft answer:
    {answer_draft}
  Retrieved chunks:
    {chunks}
  Combine the chunks with the existing draft to produce an updated answer.
  Respond in JSON with one key:
    answer_draft: the updated draft answer

answer_validate: |
  You are assessing whether the current draft fully answers the user request.
  User query: "{query}"
  Draft answer:
    {answer_draft}
  Decide if the answer is sufficient. Respond in JSON with two keys:
    is_enough: either GOOD or BAD
    next_query: if BAD, provide a concise follow-up query to continue research, otherwise empty

final_answer_generation: |
  You are polishing the final answer for a user.
  Original query: "{query}"
  Current draft answer:
    {answer_draft}
  Refine the draft into a clear and complete response.
  Respond in JSON with one key:
    final_answer: the polished answer
